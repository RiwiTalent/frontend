@using CurrieTechnologies.Razor.SweetAlert2
@using Microsoft.AspNetCore.Components.Authorization;
@using riwitalentfrontend.Services;
@inject AuthenticationStateProvider autenticacionProvider;
@inject AuthService AuthService;
@inject ISessionStorageService SessionStorage
@using Blazored.SessionStorage
@inject NavigationManager NavigationManager;
@inject HttpClient HttpClient;
@inject SweetAlertService Swal;
@using riwitalentfrontend.Models;
@namespace riwitalentfrontend.Components


<head>
    <link rel="stylesheet" href="css/Components/LoginClientComponent.css">
</head>


<MudGrid Class="pa-0 ma-0">
    <MudItem Class="d-flex justify-center align-center">
        <MudItem xs="6" sm="6" Class="d-flex justify-center align-center pa-0">
            <MudItem xs="8">
                <MudCard Class="pa-6 d-flex justify-center align-center rounded-lg">
                    <MudCardHeader>
                        <MudItem xs="12" Class="d-flex justify-center align-center">
                            <MudImage Src="images/riwi.png" ObjectFit="ObjectFit.ScaleDown" Height="50" Alt="Logo Riwi"></MudImage>
                        </MudItem>
                    </MudCardHeader>
                    <MudItem>
                        <MudText Align="Align.Center" Typo="Typo.h5"><b>¡Bienvenido/a de nuevo!</b></MudText>
                        <MudText Align="Align.Center" Typo="Typo.subtitle1">Ingresa con tu cuenta para continuar</MudText>
                    </MudItem>
                    <MudCardContent Class="FullWidth" Style="width: 100%;">

                        <MudForm Spacing="2">
                            <MudTextField T="string" Label="Correo" @bind-value="email" Variant="Variant.Outlined" InputType="InputType.Email"/>

                            <MudTextField T="string" Label="Contraseña" @bind-Value="password" Variant="Variant.Outlined" InputType="@PasswordInput" IconSize="Size.Small" Adornment="Adornment.End" AdornmentIcon="@PasswordInputIcon" OnAdornmentClick="ButtonTestclick" AdornmentAriaLabel="Ver Contraseña"/>
                        </MudForm>

                    </MudCardContent>
                    <MudCardActions>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="Login">Ingresar</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudItem>
        </MudItem>
        <MudItem xs="12" sm="6" Class="d-flex justify-center align-center pa-0 ma-0 rounded-xl" Style="background-image: url('images/Image.jpeg'); background-size: cover; background-position: center; height: 100vh; width: 100vw">
        </MudItem>
    </MudItem>
</MudGrid>

@code {
    private string email;
    private string password;
    private string passwordInputType = "password"; // Inicialmente oculto

    bool isShow;
    InputType PasswordInput = InputType.Password;
    string PasswordInputIcon = Icons.Material.Filled.VisibilityOff;

    void ButtonTestclick()
    {
        @if (isShow)
        {
            isShow = false;
            PasswordInputIcon = Icons.Material.Filled.VisibilityOff;
            PasswordInput = InputType.Password;
        }
        else {
            isShow = true;
            PasswordInputIcon = Icons.Material.Filled.Visibility;
            PasswordInput = InputType.Text;
        }
    }

    
    private async Task Login()
    {

        var succes = await AuthService.Login(email, password);


        if (succes)
        {

             // Guardar el correo en SessionStorage
            await SessionStorage.SetItemAsync("userEmail", email); // Cambia "userEmail" por la clave que desees usar

            NavigationManager.NavigateTo("/home");
            await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Bienvenido!",
                Icon = SweetAlertIcon.Success,
                Timer = 1500
            });            
        }
        else
        {
            Console.WriteLine("No funciona");
            await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Correo o contraseña incorrectos!",
                Text = "",
                Icon = SweetAlertIcon.Warning,
                ConfirmButtonText = "Intenta de nuevo",
                Timer = 1500
            });
        }
    }

    private async Task SuccessSweetAlert()
    {
        await Swal.FireAsync(new SweetAlertOptions
            {
                Title = "Error!",
                Text = "Do you want to continue",
                Icon = SweetAlertIcon.Error,
                ConfirmButtonText = "Cool"
            });
    }

}